"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{6741:(t,e,r)=>{r.d(e,{A:()=>x});var a=r(2860),o=r(3200),s=r(4612),n=r.n(s),c=r(9726),i=r(1042),l=r(3228),d=r(3959),h=r(9738),u=r(6073),g=r(7992);let m=()=>{var t;let{user:e,logout:r,isAuthenticated:o}=(0,c.A)();return(0,a.jsxs)("nav",{className:"bg-white dark:bg-gray-800 shadow-md h-16 flex items-center justify-between px-4 sm:px-6 fixed top-0 left-0 right-0 z-50 print:hidden",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(n(),{href:"/",legacyBehavior:!0,children:(0,a.jsx)("a",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:"CTaaS Platform"})})}),o&&e&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("span",{className:"mr-3 text-sm text-gray-700 dark:text-gray-300 hidden sm:inline",children:["Welcome, ",e.username]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center text-sm text-gray-600 dark:text-gray-300 mr-3",children:null===(t=e.username)||void 0===t?void 0:t.charAt(0).toUpperCase()}),(0,a.jsxs)("button",{onClick:r,className:"text-sm text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 flex items-center","aria-label":"Logout",children:[(0,a.jsx)(i.A,{size:18,className:"mr-1"}),"Logout"]})]})]})},f=()=>{let{user:t,isAuthenticated:e}=(0,c.A)(),[r,s]=(0,o.useState)(!1);if(!e)return null;let i=[{href:"/",label:"Dashboard",icon:(0,a.jsx)(l.A,{size:20}),roles:[]},{href:"/trials",label:"Trials",icon:(0,a.jsx)(d.A,{size:20}),roles:[]},{href:"/admin/users",label:"User Management",icon:(0,a.jsx)(h.A,{size:20}),roles:["Administrator"]}].filter(e=>!!t&&!!t.roles&&(0===e.roles.length||e.roles.some(e=>t.roles.includes(e)))),m=(0,a.jsx)("nav",{className:"flex-grow",children:(0,a.jsx)("ul",{children:i.map(t=>(0,a.jsx)("li",{className:"mb-1",children:(0,a.jsx)(n(),{href:t.href,legacyBehavior:!0,children:(0,a.jsxs)("a",{className:"flex items-center px-3 py-2.5 text-sm text-gray-200 hover:bg-gray-700 hover:text-white rounded-md mx-2 transition-colors duration-150 ease-in-out group",onClick:()=>r&&s(!1),children:[o.cloneElement(t.icon,{className:"mr-3 group-hover:text-blue-300 transition-colors duration-150 ease-in-out"}),t.label]})})},t.href))})});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>s(!r),className:"md:hidden fixed top-3 left-3 z-50 p-2 text-gray-600 dark:text-gray-300 bg-white dark:bg-gray-700 rounded-md shadow print:hidden","aria-label":r?"Close menu":"Open menu","aria-expanded":r,children:r?(0,a.jsx)(u.A,{size:24}):(0,a.jsx)(g.A,{size:24})}),(0,a.jsxs)("aside",{className:"bg-gray-800 text-white w-60 min-h-screen fixed left-0 top-16 pt-5 flex-col hidden md:flex print:hidden",children:[m,(0,a.jsx)("div",{className:"p-4 border-t border-gray-700 text-xs text-gray-400",children:"CTaaS Platform v1.0.0"})]}),r&&(0,a.jsxs)("div",{className:"md:hidden fixed inset-0 z-40 flex print:hidden",children:[(0,a.jsxs)("aside",{className:"bg-gray-800 text-white w-60 min-h-full pt-16 flex flex-col shadow-xl",children:[m,(0,a.jsx)("div",{className:"p-4 border-t border-gray-700 text-xs text-gray-400",children:"CTaaS Platform v1.0.0"})]}),(0,a.jsx)("div",{onClick:()=>s(!1),className:"flex-1 bg-black opacity-50"})]})]})},x=t=>{let{children:e}=t,{isAuthenticated:r,isLoading:o}=(0,c.A)();return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[(0,a.jsx)(m,{}),(0,a.jsxs)("div",{className:"flex flex-1 pt-16 ".concat(r?"md:pl-60":""," print:pt-0 print:pl-0"),children:[r&&(0,a.jsx)(f,{})," ",(0,a.jsx)("main",{className:"flex-1 p-4 sm:p-6 print:p-0 ".concat(r?"":"w-full"),children:e})]})]})}},9726:(t,e,r)=>{r.d(e,{A:()=>d,AuthProvider:()=>l});var a=r(2860),o=r(3200),s=r(6937),n=r(3345),c=r(3875);let i=(0,o.createContext)(void 0),l=t=>{let{children:e}=t,[r,l]=(0,o.useState)(!1),[d,h]=(0,o.useState)(null),[u,g]=(0,o.useState)(!0),[m,f]=(0,o.useState)(null),x=(0,s.useRouter)();(0,o.useEffect)(()=>{let t=localStorage.getItem("authToken");t?((0,n.O5)(t),y()):g(!1)},[]);let y=async()=>{g(!0);try{let t=await (0,n.VM)();h(t.user||t),l(!0),f(null)}catch(t){console.error("Failed to fetch user profile:",t),localStorage.removeItem("authToken"),(0,n.O5)(null),l(!1),h(null)}finally{g(!1)}},p=async t=>{g(!0),f(null);try{let e=await (0,n.Lx)(t);if(e.access_token)localStorage.setItem("authToken",e.access_token),await y(),x.push("/");else throw Error("Login failed: No token received.")}catch(a){var e,r;console.error("Login error:",a);let t="Login failed. Please check your credentials.";throw c.A.isAxiosError(a)&&(null===(r=a.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)?t=a.response.data.message:a instanceof Error&&"Login failed: No token received."!==a.message&&(t=a.message),f(t),l(!1),h(null),localStorage.removeItem("authToken"),(0,n.O5)(null),g(!1),a}},w=async()=>{g(!0);try{await (0,n.y4)()}catch(t){console.error("Logout API call failed (if any):",t)}finally{localStorage.removeItem("authToken"),l(!1),h(null),f(null),g(!1),x.push("/login")}};return(0,a.jsx)(i.Provider,{value:{isAuthenticated:r,user:d,login:p,logout:w,isLoading:u,error:m,clearError:()=>{f(null)}},children:e})},d=()=>{let t=(0,o.useContext)(i);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},3345:(t,e,r)=>{r.d(e,{Aq:()=>w,I3:()=>x,IR:()=>f,I_:()=>c,Jf:()=>l,Kk:()=>p,Lx:()=>N,O5:()=>n,TK:()=>E,VM:()=>C,YJ:()=>m,fm:()=>b,gu:()=>g,iS:()=>v,jD:()=>d,lo:()=>k,mc:()=>h,nT:()=>i,pV:()=>u,rx:()=>y,sH:()=>j,y4:()=>A});var a=r(3875);let o=r(4916).env.NEXT_PUBLIC_API_URL||"/api/v1",s=a.A.create({baseURL:o,headers:{"Content-Type":"application/json"}}),n=t=>{t?s.defaults.headers.common.Authorization="Bearer ".concat(t):delete s.defaults.headers.common.Authorization},c=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.get("/trials",{params:t})).data}catch(t){throw console.error("Error fetching trials:",t),t}},i=async t=>{try{return(await s.get("/trials/".concat(t))).data}catch(e){throw console.error("Error fetching trial ".concat(t,":"),e),e}},l=async t=>{try{return(await s.post("/trials",t)).data}catch(t){throw console.error("Error creating trial:",t),t}},d=async t=>{try{return(await s.get("/trials/".concat(t,"/protocols"))).data}catch(e){throw console.error("Error fetching protocols for trial ".concat(t,":"),e),e}},h=async(t,e)=>{try{return(await s.post("/trials/".concat(t,"/protocols/draft"),e)).data}catch(e){throw console.error("Error drafting protocol for trial ".concat(t,":"),e),e}},u=async t=>{try{return(await s.get("/protocols/generation-status/".concat(t))).data}catch(e){throw console.error("Error fetching protocol generation status for task ".concat(t,":"),e),e}},g=async t=>{try{return(await s.get("/trials/".concat(t,"/irb-submissions"))).data}catch(e){throw console.error("Error fetching IRB submissions for trial ".concat(t,":"),e),e}},m=async(t,e)=>{try{return(await s.post("/trials/".concat(t,"/irb-submissions"),e)).data}catch(e){throw console.error("Error creating IRB submission for trial ".concat(t,":"),e),e}},f=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.get("/sites",{params:t})).data}catch(t){throw console.error("Error fetching global sites:",t),t}},x=async t=>{try{return(await s.get("/trials/".concat(t,"/sites"))).data}catch(e){throw console.error("Error fetching sites for trial ".concat(t,":"),e),e}},y=async(t,e)=>{try{return(await s.post("/trials/".concat(t,"/sites"),e)).data}catch(e){throw console.error("Error associating site to trial ".concat(t,":"),e),e}},p=async t=>{try{return(await s.get("/trials/".concat(t,"/patients"))).data}catch(e){throw console.error("Error fetching patients for trial ".concat(t,":"),e),e}},w=async(t,e)=>{try{return(await s.post("/trials/".concat(t,"/patients/identify"),e)).data}catch(e){throw console.error("Error identifying patients for trial ".concat(t,":"),e),e}},v=async t=>{try{return(await s.get("/patients/identification-status/".concat(t))).data}catch(e){throw console.error("Error fetching patient identification status for task ".concat(t,":"),e),e}},b=async t=>{try{return(await s.get("/trials/".concat(t,"/monitoring/summary"))).data}catch(e){throw console.error("Error fetching monitoring summary for trial ".concat(t,":"),e),e}},j=async t=>{try{return(await s.get("/trials/".concat(t,"/monitoring/events"))).data}catch(e){throw console.error("Error fetching monitoring events for trial ".concat(t,":"),e),e}},k=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.get("/admin/users",{params:t})).data}catch(t){throw console.error("Error fetching users:",t),t}},E=async(t,e)=>{try{return(await s.put("/admin/users/".concat(t),e)).data}catch(e){throw console.error("Error updating user ".concat(t,":"),e),e}},N=async t=>{try{let e=await s.post("/auth/login",t);return e.data.access_token&&n(e.data.access_token),e.data}catch(t){throw console.error("Error logging in:",t),n(null),t}},A=async()=>{n(null)},C=async()=>{try{return(await s.get("/users/me/profile")).data}catch(t){throw console.error("Error fetching user profile:",t),t}}}}]);